<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiche de Personnage - The Witcher</title>
    <link href="../styles/styles.css" rel="stylesheet">
    <script src="../datas/constantes.js"></script>
    <script src="../scripts/utils.js"></script>
    <script src="../datas/cache.js"></script>
    <script src="../scripts/saveSystem.js"></script>
    <script src="../scripts/main.js" defer></script>
</head>
<style>
    h2{
        width: 10rem;
    }

    .addRowButton{
        height: 2rem;
        background-color: lightgreen;
    }

    .titleDiv{
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 2rem;
    }
    table{
        width: 98%;
    }
    
</style>
<body>
    <h1>The Witcher<h1>
    <nav>
        <button><a href="../character.html">Fiche</a></button>
        <button><a href="./grimoire.html">Grimoire</a></button>
        <button><a href="#">Aide/Rappels</a></button>
        <button><a href="#">Notes/Background</a></button>
        <button><a href="#">Inventaire/Composants</a></button>
    </nav>
    <div class="infos-container container">
        <h1>Inventaire et Composants</h1>
        <section class="infos-container"></section>
            <div class="titleDiv">
                <h2>Armes</h2> 
                <button class="addRowButton" onclick="addRow('weapon')">Ajouter</button>
            </div>
            <table id="weapons-table">
                <tr>
                    <th>Nom</th>
                    <th>Type</th>
                    <th>Précision</th>
                    <th>Poids</th>
                    <th>Dégâts</th>
                    <th>Fia.</th>
                    <th>Mains</th>
                    <th>Portée</th>
                    <th>Effet</th>
                    <th>Dissumlation</th>
                    <th>Amélioration</th>
                    <th>Equipé</th>
                    <th>Actions</th>
                </tr>

            </table>
        </section>
        <section class="infos-container"></section>
            <div class="titleDiv">
                <h2>Armures</h2>
                <button class="addRowButton" onclick="addRow('armor')">Ajouter</button>
            </div>
            <table id="armors-table">
                <tr>
                    <th>Nom</th>
                    <th>Localisation</th>
                    <th>PA</th>
                    <th>Poids</th>
                    <th>Dégâts</th>
                    <th>Effet</th>
                    <th>Equipé</th>
                    <th>Actions</th>
                </tr>
            </table>
        </section>
        
        <section class="infos-container">
            <div class="titleDiv">
                <h2>Divers</h2>
                <button class="addRowButton" onclick="addRow('miscellaneous')">Ajouter</button>
            </div>
            <table id="miscellaneous-table">
                <tr>
                    <th>Nom</th>
                    <th>Quantité</th>
                    <th>Poids Unité</th>
                    <th>Poids total</th>
                    <th>Notes</th>
                    <th>Couts</th>
                    <th>Actions</th>
                </tr>
            </table>
        </section>
        <section class="infos-container">
            <div class="titleDiv">
                <h2>Composants</h2>
                <button class="addRowButton" onclick="addRow('component')">Ajouter</button>
            </div>
            <table id="components-table">
                <tr>
                    <th>Nom</th>
                    <th>Quantité</th>
                    <th>Poids Unité</th>
                    <th>Poids total</th>
                    <th>Couts</th>
                    <th>Substance</th>
                    <th>Actions</th>
                </tr>
            </table>
        </section>
    </div>

</body>
<script type="text/javascript">
    let weightInputList = "";
    let weightTt = 0;
    let cache = loadCache();
    function addRow(type) {
        const weaponsRowBase = `
            <td><input type="text" size="10"></td> 
            <td><input type="text" size="10"></td>
            <td><input type="number" size="2"></td>
            <td><input type="number" size="2" class="weightInput"></td>
            <td><input type="text" size="10"></td>
            <td><input type="number" size="2"></td>
            <td><input type="number" size="2"></td>
            <td><input type="text" size="10"></td>
            <td><textarea rows="1" cols="auto"></textarea></td>
            <td><input type="text" size="10"></td>
            <td><input type="number" size="2"></td>
            <td><input type="checkbox"></td>
            
        `;

        const armorsRowBase = `
            <td><input type="text" size="10"></td>
            <td><input type="text" size="10"></td>
            <td><input type="number" size="2"></td>
            <td><input type="number" size="2" class="weightInput"></td>
            <td><input type="number" size="2"></td>
            <td><textarea rows="1" cols="auto"></textarea></td>
            <td><input type="checkbox"></td>
        `;
        const miscellaneousRowBase = `
            <td><input type="text" size="10"></td>
            <td><input type="number" size="2" value="1"></td>
            <td><input type="number" size="2"></td>
            <td><input type="number" size="2" class="weightInput"></td>
            <td><textarea rows="1" cols="auto"></textarea></td>
            <td><input type="number" size="2"></td>
            
        `;
        const componentRowBase = `
            <td><input type="text" size="10"></td>
            <td><input type="number" size="2" value="1"></td>
            <td><input type="number" size="2"></td>
            <td><input type="number" size="2" class="weightInput"></td>
            <td><input type="number" size="2"></td>
            <td><input type="text" size="10"></td>
            
        `;

        let table ="";
        let row = document.createElement("tr");
        switch(type){
            case "weapon":
                table = document.getElementById("weapons-table");
                row.innerHTML = weaponsRowBase;
                table.appendChild(row);
                break;
            case "armor":
                table = document.getElementById("armors-table");
                row.innerHTML = armorsRowBase;
                table.appendChild(row);
                break;

            case "miscellaneous":
                table = document.getElementById("miscellaneous-table");
                row.innerHTML = miscellaneousRowBase;
                table.appendChild(row);
                break;

            case "component":
                table = document.getElementById("components-table");
                row.innerHTML = componentRowBase;
                table.appendChild(row);
                break;
        }
        let cell = document.createElement("td");
        let buttonDel = document.createElement("button");
        cell.appendChild(buttonDel);
        console.log(cell)
        row.appendChild(cell);
        buttonDel.innerText = "supprimer";
        buttonDel.style.backgroundColor = "red";
        buttonDel.addEventListener("click", e=> {
            weightTt -= parseFloat(row.children[3].firstChild.value); // search cell of weigth total then the input's value
            cache.character.currentWeight = weightTt;
            localStorage.setItem(keys.storage, JSON.stringify(cache))
            table.deleteRow(row.rowIndex);
        })
        weightInputList = document.getElementsByClassName("weightInput");
        for(let w of weightInputList){
            let timeout = null;
            w.addEventListener('input', e => {
            
                clearTimeout(timeout);
                // Make a new timeout set to go off in 1000ms (1 second)
                timeout = setTimeout(function () {
                    weightTt += parseFloat(e.target.value);
                    cache.character.currentWeight = weightTt;
                    localStorage.setItem(keys.storage, JSON.stringify(cache))
                }, 1000);
                        
            })
        }
    }
</script>
</html>